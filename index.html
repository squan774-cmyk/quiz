<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>å…µåº«çœŒæ”¿ã‚¯ã‚¤ã‚º</title>
<style>
  :root{
    --bg:#0b1220;
    --panel:#0f1724;
    --accent:#ffd166;
    --text:#e6eef8;
    --muted:#9fb1c8;
    --barbg:#213246;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#08121b 0%, #0b1622 100%);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;color:var(--text);-webkit-tap-highlight-color:transparent}
  #app{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:env(safe-area-inset-top) 12px 12px;gap:12px}
  header{width:100%;max-width:900px;display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:rgba(255,255,255,0.02);border-radius:12px}
  header h1{margin:0;font-size:16px}
  main{width:100%;max-width:900px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:12px}
  .stage{position:relative;min-height:420px;padding:12px;border-radius:10px;background:rgba(0,0,0,0.12);display:flex;flex-direction:column;align-items:center;gap:10px}
  .question{font-size:18px;text-align:center;padding:6px 12px;background:rgba(255,255,255,0.02);border-radius:8px;min-height:46px;display:flex;align-items:center;justify-content:center}
  .choices{display:flex;width:100%;gap:12px;justify-content:center}
  .choice{flex:1;min-height:84px;border-radius:10px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-size:18px;padding:12px;position:relative;touch-action: manipulation;user-select:none}
  .choice.disabled{opacity:0.6;pointer-events:none}
  .choice .overlayIcon{position:absolute;top:-26px;left:50%;transform:translateX(-50%);width:64px;height:64px;pointer-events:none;display:none}
  .choice .mark{position:absolute;top:6px;right:6px;font-size:34px;line-height:1;pointer-events:none}
  .timerWrap{width:100%;height:18px;background:var(--barbg);border-radius:10px;overflow:hidden}
  .timerBar{height:100%;width:100%;background:linear-gradient(90deg,var(--accent),#ff9f43);transition:width 0.1s linear}
  .bottomRow{display:flex;justify-content:space-between;align-items:flex-end;width:100%}
  .avatarPanel{width:48%;display:flex;flex-direction:column;align-items:flex-start;gap:6px;min-height:120px;position:relative}
  .avatarPanel.cpu{align-items:flex-end}
  .avatarBox{position:relative;width:140px;height:140px;border-radius:12px;overflow:visible;display:flex;align-items:center;justify-content:center}
  .avatarBox img{max-width:100%;max-height:100%;display:block}
  .scorePanel{position:absolute;inset:auto 0 0 0;background:rgba(0,0,0,0.35);padding:6px 10px;border-radius:8px;color:var(--text);font-weight:700;display:flex;gap:8px;align-items:center;justify-content:center}
  .scorePanel .label{font-size:12px;color:var(--muted);font-weight:600}
  .controls{display:flex;gap:8px;align-items:center}
  button{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.03);color:var(--text);padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
  .explain{background:rgba(0,0,0,0.4);padding:12px;border-radius:10px}
  .centerMessage{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
  .bigText{font-size:28px;font-weight:900;text-align:center;background:linear-gradient(90deg,#fff,#dfefff);-webkit-background-clip:text;background-clip:text;color:transparent}
  footer{width:100%;max-width:900px;display:flex;justify-content:center;padding:10px;color:var(--muted);font-size:12px}
  /* small screen adjustments */
  @media (max-width:520px){
    .avatarBox{width:110px;height:110px}
    .choice .overlayIcon{width:52px;height:52px;top:-22px}
    .choice{min-height:74px;font-size:16px}
  }
.avatarBox {
  position: relative;
  width: 140px;
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ã‚¹ã‚³ã‚¢ãƒ‘ãƒãƒ«ã‚’ç”»åƒã®ä¸‹ä¸­å¤®ã«é…ç½® */
.scorePanel {
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.35);
  padding: 6px 10px;
  border-radius: 8px;
  color: var(--text);
  font-weight: 700;
  display: flex;
  gap: 8px;
  align-items: center;
  justify-content: center;
  min-width: 100px;
}

/* ã‚¹ãƒãƒ›ã§ã¯å°‘ã—å°ã•ã */
@media (max-width:520px){
  .avatarBox {
    width: 110px;
    height: 110px;
  }
  .scorePanel {
    bottom: -8px;
    font-size: 14px;
    min-width: 80px;
  }
}
</style>
</head>
<body>
<div id="app">
  <header>
    <h1>å…µåº«çœŒæ”¿ã‚¯ã‚¤ã‚ºâ€” ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ vs æ–è—¤å…ƒå½¦</h1>
    <div class="controls">
      <button id="restartBtn">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button id="bgmToggle">BGM: å†ç”Ÿ</button>
    </div>
  </header>

  <main>
    <div class="stage" id="stage">
 <!-- è¿½åŠ ã“ã“ã‹ã‚‰ -->
    <div id="startScreen" style="text-align:center; margin-top:40px;">
      <button id="startBtn" style="font-size:20px; padding:12px 24px;">ã‚¯ã‚¤ã‚ºã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </div>
      <div class="question" id="questionText">èª­ã¿è¾¼ã¿ä¸­...</div>

      <div class="choices" id="choices">
        <div class="choice" id="choiceA" data-choice="A">
          <div class="overlayIcon" id="overlayA"><img src="player4.png" alt="player icon" style="width:100%;height:100%"></div>
          <div class="overlayIcon" id="overlayA_cpu" style="display:none"><img src="hiko5.png" alt="cpu icon" style="width:100%;height:100%"></div>
          <div class="mark" id="markA"></div>
          <div class="text" id="textA">A</div>
        </div>
        <div class="choice" id="choiceB" data-choice="B">
          <div class="overlayIcon" id="overlayB"><img src="player4.png" alt="player icon" style="width:100%;height:100%"></div>
          <div class="overlayIcon" id="overlayB_cpu" style="display:none"><img src="hiko5.png" alt="cpu icon" style="width:100%;height:100%"></div>
          <div class="mark" id="markB"></div>
          <div class="text" id="textB">B</div>
        </div>
      </div>

      <div style="width:100%;display:flex;gap:12px;flex-direction:column">
        <div class="timerWrap"><div class="timerBar" id="timerBar"></div></div>
      </div>

      <div class="bottomRow">
        <div class="avatarPanel player">
          <div class="avatarBox">
            <img id="playerImg" src="player.png" alt="player">
            <div class="scorePanel" id="playerScorePanel">
              <div style="display:flex;flex-direction:column">
                <div class="label">PLAYER</div>
                <div id="playerScore" style="font-size:22px">0</div>
              </div>
            </div>
          </div>
        </div>

        <div class="avatarPanel cpu">
          <div class="avatarBox">
            <img id="cpuImg" src="hiko.png" alt="cpu">
            <div class="scorePanel" id="cpuScorePanel">
              <div style="display:flex;flex-direction:column;align-items:flex-end">
                <div class="label">æ–è—¤å…ƒå½¦</div>
                <div id="cpuScore" style="font-size:22px">0</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="explainArea" style="width:100%;display:none" class="explain">
        <div id="explainText"></div>
        <div style="display:flex;justify-content:flex-end;margin-top:8px">
          <button id="nextBtn">æ¬¡ã¸</button>
        </div>
      </div>

      <div class="centerMessage" id="centerMessage" style="display:none;pointer-events:auto">
        <div style="text-align:center">
          <div class="bigText" id="centerMain"></div>
          <div style="margin-top:12px">
            <button id="centerAction">å†ãƒ—ãƒ¬ã‚¤</button>
          </div>
        </div>
      </div>

    </div>
  </main>

  <footer>â€»ã“ã®ã‚¯ã‚¤ã‚ºã¯æ­£ã—ã„è³‡æ–™ã«åŸºã¥ã„ã¦ä½œæˆã—ã¦ã„ã¾ã™ã€‚</footer>
</div>

<!-- Audio (preload) -->
<audio id="sfxCorrect" src="pinpon.mp3" preload="auto"></audio>
<audio id="sfxWrong" src="bu.mp3" preload="auto"></audio>
<audio id="bgm" src="bgm.mp3" loop preload="auto"></audio>

<script>
(() => {
  // --- è³ªå•å®šç¾©ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æä¾›ã®å•é¡Œï¼‰ ---
  const allQuestions = [
    {id:1, q:"å½“æ™‚ã®å¯¾å¿œã¯ï¼Ÿ", A:"é©åˆ‡", B:"ä¸é©åˆ‡", correct:"B", cpu:"A_wrong", explain:"ç¬¬ä¸‰è€…å§”å“¡ä¼šã¯å½“æ™‚ã®å¯¾å¿œã¯ä¸é©åˆ‡ã ã£ãŸã¨èªå®šã—ãŸã€‚"},
    {id:2, q:"æ–è—¤å…ƒå½¦ã®å‘Šç™ºè€…æ¢ã—ã¯é•æ³•ï¼Ÿãã‚Œã¨ã‚‚é©æ³•ï¼Ÿ", A:"é•æ³•", B:"é©æ³•", correct:"A", cpu:"B_wrong", explain:"ç¬¬ä¸‰è€…å§”å“¡ä¼šã¯æ–è—¤å…ƒå½¦ã«ã‚ˆã‚‹å‘Šç™ºè€…æ¢ã—ã‚’é•æ³•ã¨èªå®šã—ãŸã€‚"},
    {id:3, q:"æ–è—¤å…ƒå½¦ãŒé•åã—ãŸã®ã¯å…¬ç›Šé€šå ±â–¡ä¿è­·æ³•ã€‚â–¡ã«å…¥ã‚‹ã®ã¯ï¼Ÿ", A:"è€…", B:"ä½•ã‚‚å…¥ã‚‰ãªã„", correct:"A", cpu:"B_wrong", explain:"æ–è—¤å…ƒå½¦ã¯ä½•æ•…ã‹ã€Œè€…ã€ã‚’æŠœã„ã¦å…¬ç›Šé€šå ±ä¿è­·æ³•ã¨è¨€ã†ã€‚"},
    {id:4, q:"æ–è—¤å…ƒå½¦ãŒèªå®šã•ã‚ŒãŸãƒ‘ãƒ¯ãƒãƒ©ã¯ä½•ä»¶ï¼Ÿ", A:"10ä»¶", B:"0ä»¶", correct:"A", cpu:"B_wrong", explain:"ç¬¬ä¸‰è€…å§”å“¡ä¼šã¯èª¿æŸ»ã—ãŸ16é …ç›®ä¸­10é …ç›®ã‚’ãƒ‘ãƒ¯ãƒãƒ©ã¨èªå®šã—ãŸã€‚"},
    {id:5, q:"æ–è—¤å…ƒå½¦ãŒã€ŒæŠ˜ã‚’è¦‹ã¦ã‚ˆã‚ã—ãã€ã¨ãŠã­ã ã‚Šã—ãŸç‰©ã¯ä½•ï¼Ÿ", A:"ãƒ¯ã‚¤ãƒ³", B:"è¨˜æ†¶ã«ç„¡ã„", correct:"A", cpu:"B_wrong", explain:"å…ƒå½¦ãŒãƒ¯ã‚¤ãƒ³ã‚’ãŠã­ã ã‚Šã—ã¦ã„ãŸè¨¼æ‹ éŸ³å£°ã‚’çªãä»˜ã‘ã‚‰ã‚ŒãŸéš›ã®ç¬¬ä¸€å£°ãŒã€Œè¨˜æ†¶ã«ç„¡ã„ã€ã ã£ãŸã€‚"},
    {id:6, q:"ã‚µãƒ¼ãƒ“ã‚¹å•é¡Œã§ã™ã€‚æ–è—¤å…ƒå½¦ãŒå…µåº«çœŒçŸ¥äº‹é¸ã§ã‚¿ãƒƒã‚°ã‚’çµ„ã‚“ã ã®ã¯ï¼Ÿ", A:"ç«‹èŠ±å­å¿—", B:"ç«‹èŠ±å­å¿—", correct:"AB", cpu:"silent_hiko4", explain:"ç«‹èŠ±å­å¿—ã¯æ–è—¤å…ƒå½¦ã‚’æ”¯æ´ã™ã‚‹ã¨ã„ã†ç•°ä¾‹ã®ç›®çš„ã§ç«‹å€™è£œã—ãŸã€‚"},
    {id:7, q:"ç™¾æ¡å§”å“¡ä¼šå§”å“¡ã®è²¬å‹™ã‚’å…¨ã†ã—ãŸã®ã¯ï¼Ÿ", A:"å¥¥è°·è¬™ä¸€", B:"å¢—å±±èª ", correct:"A", cpu:"B_wrong", explain:"å¥¥è°·è¬™ä¸€çœŒè­°ã¯å§”å“¡é•·ã¨ã—ã¦æœ€å¾Œã¾ã§ä¸­ç«‹ã‚’å®ˆã£ãŸã€‚"},
    {id:8, q:"ã‚µãƒ¼ãƒ“ã‚¹å•é¡Œã§ã™ã€‚æ”¯æ´è€…ãŒæ–è—¤å…ƒå½¦ã«é€ã£ãŸLINE(æ—¢èª­)ã«åå‰ãŒå‡ºãŸçœŒè­°ã¯ï¼Ÿ", A:"å²¸å£å®Ÿ", B:"å²¸å£å®Ÿ", correct:"AB", cpu:"silent_hiko4", explain:"LINEã®å†…å®¹ã¯ã€å…ƒçœŒæ°‘å±€é•·ã®ç§çš„æƒ…å ±ã‚’æš´éœ²ã•ã‚ŒãŸããªã‘ã‚Œã°å…ƒå±€é•·ã‚’ç™¾æ¡å§”å“¡ä¼šã«å‘¼ã¶ãªã¨å²¸å£å®ŸãŒè„…ã—ã‚’ã‹ã‘ãŸã¨ã„ã†è©±ã€‚LINEã®æ—¥ä»˜ã¯2024å¹´6æœˆ29æ—¥ã€‚ã“ã®æ™‚ç‚¹ã§å²¸å£ã¨æ–è—¤å…ƒå½¦ã¯å…ƒå±€é•·ã®ç§çš„æƒ…å ±ã«ã¤ã„ã¦çŸ¥ã£ã¦ã„ãŸäº‹ã«ãªã‚Šã€ãã®å¾Œã®è¨¼è¨€ã¨çŸ›ç›¾ã™ã‚‹ã€‚é€±åˆŠèªŒã«å ±ã˜ã‚‰ã‚ŒãŸã“ã®ä»¶ã«ã¤ã„ã¦ã€æ–è—¤å…ƒå½¦ã¯å ±é“ã‚’çŸ¥ã‚‰ãªã„ã¨è¨€ã£ã¦é€ƒã’ç¶šã‘ã¦ã„ã‚‹ã€‚"},
    {id:9, q:"ã‚µãƒ¼ãƒ“ã‚¹å•é¡Œã§ã™ã€‚ãƒ›ãƒ†ãƒ«ã‚ªãƒ¼ã‚¯ãƒ©ã«ã¦ç«‹èŠ±å­å¿—ã«æ€ªæ–‡æ›¸ã‚’æ¸¡ã—ãŸã®ã¯ï¼Ÿ", A:"å²¸å£å®Ÿ", B:"å²¸å£å®Ÿ", correct:"AB", cpu:"silent_hiko4", explain:"æ§˜ã€…ãªçœŒè­°ã«é–¢ã™ã‚‹ãƒ‡ãƒã¾ã¿ã‚Œã®æ€ªæ–‡æ›¸ã‚’å²¸å£ãŒç«‹èŠ±ã«æ¸¡ã—ãŸã›ã„ã§ã€å¤šãã®èª¹è¬—ä¸­å‚·ãŒç”Ÿã¾ã‚ŒãŸã€‚"},
    {id:10, q:"ã‚µãƒ¼ãƒ“ã‚¹å•é¡Œã§ã™ã€‚éŒ²éŸ³ç¦æ­¢ã®ç™¾æ¡å§”å“¡ä¼šç§˜å¯†ä¼šã«ã¦ã€ç‰‡å±±å…ƒå‰¯çŸ¥äº‹ã¸ã®è³ªå•æ™‚ã«éŒ²éŸ³ã‚’ã—ã¦ç«‹èŠ±å­å¿—ã«æ¸¡ã—ãŸçœŒè­°ã¯ï¼Ÿ", A:"å¢—å±±èª ", B:"å¢—å±±èª ", correct:"AB", cpu:"silent_hiko4", explain:"å¢—å±±èª ã¯ç™¾æ¡å§”å“¡ä¼šã‚’éŒ²éŸ³ç¦æ­¢ã®ç§˜å¯†ä¼šã«ã™ã‚‹æ±ºè­°ã«ã¯è³›æˆã—ã¦ãŠã„ã¦ã€è‡ªèº«ã®è³ªå•æ™‚ã«éŒ²éŸ³ã—ãã‚Œã‚’æ„å›³çš„ã«æ¼æ´©ã€‚"},
    {id:11, q:"èºå‹•ã®ä¼šã®çœŒè­°ã¯ä¸‰äººã€‚å¢—å±±ã¨å²¸å£ã€ã‚ã¨ä¸€äººã¯ï¼Ÿ", A:"ç™½ä¸¼ï¼Ÿ", B:"è‡¼äº•ï¼Ÿ", correct:"none", cpu:"silent", explain:"å¤šåˆ†ç™½äº•ã€‚"},
    {id:12, q:"2025å¹´10æœˆç¾åœ¨ã€æ–è—¤å…ƒå½¦ãŒæ›¸é¡é€æ¤œã•ã‚Œã¦ã‚‹ã®ã¯èƒŒä»»ç½ªã¨ä½•ï¼Ÿ", A:"å…¬é¸æ³•é•å", B:"åœ°æ–¹å…¬å‹™å“¡æ³•é•å", correct:"A", cpu:"silent_hiko4", explain:"åœ°æ–¹å…¬å‹™å“¡æ³•é•åã§ã‚‚å‘Šç™ºã•ã‚Œã¦ã„ã‚‹ãŒã€æ›¸é¡é€æ¤œã¯ã¾ã å…ˆã§ã‚ã‚‹(2025å¹´10æœˆç¾åœ¨)"},
    {id:13, q:"æ–è—¤å…ƒå½¦ãŒè‡ªã‚‰è¨­ç½®ã—ãŸã®ã«å ±å‘Šã‚’èãå…¥ã‚Œãªã‹ã£ãŸç¬¬ä¸‰è€…å§”å“¡ä¼šã«ã‹ã‹ã£ãŸç„¡é§„ãªç¨é‡‘ã¯ã„ãã‚‰ï¼Ÿ", A:"5200ä¸‡å††", B:"0å††", correct:"A", cpu:"B_wrong", explain:"æ–è—¤å…ƒå½¦ã‚‚ãã®æ”¯æŒè€…é”ã‚‚ç¬¬ä¸‰è€…å§”å“¡ä¼šã«é‡ãã‚’ç½®ã„ã¦ã„ãŸãŒã€ä¸åˆ©ãªå ±å‘ŠãŒãªã•ã‚ŒãŸé€”ç«¯ã«æ…‹åº¦ã‚’ä¸€å¤‰ã•ã›ä»Šæ—¥ã‚‚ç¬¬ä¸‰è€…å§”å“¡ä¼šå©ãã«ç²¾ã‚’å‡ºã—ã¦ã„ã‚‹ã€‚"},
    {id:14, q:"æ–è—¤å…ƒå½¦ãŒå¥½ããªã®ã¯ï¼Ÿ", A:"è‡ªæ’®ã‚Š", B:"å…¬å‹™", correct:"A", cpu:"A_correct", explain:"æ–è—¤å…ƒå½¦ã¯å…¬å‹™ã§ç”ºé•·ã‹ã‚‰æ¡ˆå†…ã‚’å—ã‘ãŸéš›ã€ç”ºé•·ã®è©±ã‚’èã‹ãšã«è‡ªæ’®ã‚Šã—ã¦ã„ãŸäº‹ãŒãƒãƒ¬ã¦ç‚ä¸Šã—ãŸã€‚"},
    {id:15, q:"æ–è—¤å…ƒå½¦ãŒå¥½ããªé£Ÿã¹ç‰©ã¯ï¼Ÿ", A:"ãƒ”ã‚¶ãƒˆãƒ¼ã‚¹ãƒˆ", B:"ä½•ã§ã‚‚ç¾å‘³ã—ãã„ãŸã ãã¾ã™ã€‚", correct:"AB", cpu:"B_correct", explain:"é¸æŒ™ã‚¦ã‚©ãƒƒãƒãƒ£ãƒ¼ã¡ã ã„æ°ã®è³ªå•ã‹ã‚‰é€ƒã’å›ã‚‹æ–è—¤å…ƒå½¦ã¯ã€èª°ã§ã‚‚ç­”ãˆã‚‰ã‚Œã‚‹ã§ã‚ã‚ã†ã€Œå¥½ããªé£Ÿã¹ç‰©ã¯ï¼Ÿã€ã¨ã„ã†è³ªå•ã‹ã‚‰ã‚‚é€ƒã’ã¦ã“ã†ç­”ãˆãŸã€‚ã¡ãªã¿ã«ãƒ”ã‚¶ãƒˆãƒ¼ã‚¹ãƒˆã§ã‚‚æ­£è§£ã§ã‚ã‚‹ã€‚"},
    {id:16, q:"ã‚µãƒ¼ãƒ“ã‚¹å•é¡Œã§ã™ã€‚ç™¾æ¡å§”å“¡ä¼šã«ãŠã„ã¦å¢—å±±èª ãŒç«¹å†…å…ƒçœŒè­°ã«é–¢ã™ã‚‹äº‹å®Ÿèª¤èªã®ãƒ‡ãƒã‚’3é€£ç™ºã—ã¾ã—ãŸãŒã€èª¤ã‚Šãªã®ã«ä½•æ•…ã‹å…¨ä¹—ã£ã‹ã‚Šã—ã¦ãŸã®ã¯èª°ï¼Ÿ", A:"æ–è—¤å…ƒå½¦", B:"æ–è—¤å…ƒå½¦", correct:"AB", cpu:"silent_hiko4", explain:"å¢—å±±ã®è³ªå•ã¯ç«¹å†…å…ƒçœŒè­°ãŒç™¾æ¡å§”å“¡ä¼šã«ãŠã„ã¦è¨€ã£ã¦ã‚‚ç„¡ã„è©±ã ã£ãŸã®ã«ã€æ–è—¤å…ƒå½¦ã¯å…ƒçœŒè­°ã«ãã†è¨€ã‚ã‚Œã¦å¿ƒãŒç—›ã‚“ã ã€ã‚·ãƒ§ãƒƒã‚¯ã ã£ãŸã¨ç­”ãˆãŸã€‚å¢—å±±èª ã¯å¾Œã«äº‹å®Ÿèª¤èªã§ã‚ã£ãŸã¨èªã‚ã€è­°äº‹éŒ²ãŒè¨‚æ­£ã•ã‚ŒãŸã€‚"},
    {id:17, q:"çœŸæ‘¯ã«ï¼Ÿ", A:"å—ã‘æ­¢ã‚ã‚‹", B:"å—ã‘æµã™", correct:"B", cpu:"A_wrong", explain:"çœŸæ‘¯ã«å—ã‘æ­¢ã‚ã‚‹ã¯æ–è—¤å…ƒå½¦ã®å¿…æ®ºæŠ€ã ãŒã€å®Ÿéš›ã«å—ã‘æ­¢ã‚ã¦ã„ãŸä¾‹(ãŸã‚ã—)ãŒãªã„ã€‚"},
    {id:18, q:"ã‚†ã‹ãŸç¥­ã‚Šã«ãŠã„ã¦æ–è—¤å…ƒå½¦ãŒãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ã«æ€’é³´ã£ãŸã¨ã„ã†ãƒ‡ãƒã‚’æµã—ãŸã®ã¯èª°ï¼Ÿ", A:"ç«¹å†…å…ƒçœŒè­°", B:"å§«è·¯å¸‚é–¢ä¿‚è€…", correct:"none", cpu:"A_wrong", explain:"Aã‚‚Bã‚‚ä¸æ­£ç¢ºã§ã‚ã‚‹ã€‚AERAã®è¨˜äº‹ã«ãŠã‘ã‚‹è¨˜è¿°ã¯ã€å…ƒå½¦ãŒãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ã«æ€’é³´ã£ãŸã®ã§ã¯ãªãã€å…ƒå½¦ã®æ€’å£°ãŒãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ã«ã‚‚èã“ãˆãŸã¨ã„ã†ã‚‚ã®ã€‚ãã‚Œã‚‚å§«è·¯å¸‚é–¢ä¿‚è€…ã®è¨¼è¨€ã§ã‚ã‚‹ã€‚å…ƒå½¦ãŒãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ã«æ€’é³´ã£ãŸã¨ã„ã†ãƒ‡ãƒã‚’ç«¹å†…å…ƒçœŒè­°ãŒæµã—ãŸã¨ã„ã†è©±ãŒå…¨ãã®ãƒ‡ãƒãªã®ã§ã‚ã‚‹ã€‚"},
    {id:19, q:"ã‚µãƒ¼ãƒ“ã‚¹å•é¡Œã§ã™ã€‚å‘Šç™ºè€…ã®ç§çš„æƒ…å ±ã‚’æ¼æ´©ã™ã‚‹ã‚ˆã†æŒ‡ç¤ºã—ãŸã¨ç¬¬ä¸‰è€…å§”å“¡ä¼šã«èªå®šã•ã‚ŒãŸã®ã¯èª°ï¼Ÿ", A:"æ–è—¤å…ƒå½¦", B:"æ–è—¤å…ƒå½¦", correct:"AB", cpu:"silent_hiko4", explain:"æ¼æ´©ã®å®Ÿè¡ŒçŠ¯äº•ãƒæœ¬ãŒå…ƒå½¦ã®æŒ‡ç¤ºã ã£ãŸã¨è¨¼è¨€ã€‚å½“æ™‚åŒå¸­ã—ã¦ã„ãŸå°æ©‹ã‚‚åŒã˜ã‚ˆã†ã«è¨¼è¨€ã—ã¦ãŠã‚Šã€ãã®å ±å‘Šã‚’ç¢ºã‹ã«å—ã‘ã¦ã„ãŸã¨ç‰‡å±±å…ƒå‰¯çŸ¥äº‹ã‚‚è¨¼è¨€ã€‚"},
    {id:20, q:"å…ƒçœŒæ°‘å±€é•·ã«ã‚ˆã‚‹å‘Šç™ºã¯äº•æˆ¸æ´¾ã®ã‚¯ãƒ¼ãƒ‡ã‚¿ãƒ¼ã ã£ãŸï¼Ÿ", A:"ã¯ã„", B:"ã„ã„ãˆ", correct:"B", cpu:"A_wrong", explain:"ä¸€éƒ¨æµå‡ºã—ãŸå…ƒçœŒæ°‘å±€é•·ã®æ—¥è¨˜ã«ã¯äº•æˆ¸æ°ã¸ã®ä¸æº€ã‚‚è¨˜ã•ã‚Œã¦ãŠã‚Šã€äº•æˆ¸æ´¾ã§ã¯ãªã„äº‹ãŒåˆ¤æ˜ã€‚ã¾ãŸã€æ–è—¤å…ƒå½¦ã‚’å¿ƒé…ã™ã‚‹è¨˜è¿°ã‚‚ã‚ã£ãŸã€‚"},
    {id:21, q:"æ–è—¤çŸ¥äº‹ã®ãŠè”­ã§çœŒã®è²¡æ”¿ã¯æ”¹å–„ã•ã‚ŒãŸï¼Ÿ", A:"ã¯ã„", B:"ã„ã„ãˆ", correct:"B", cpu:"A_wrong", explain:"ä¼æ¥­ã®æ¥­ç¸¾ã‚¢ãƒƒãƒ—ã¨ã‚³ãƒ­ãƒŠç¦ãŒã‚ã‘ãŸåŠ¹æœã§ç¨åãŒå¢—ã—ãŸã ã‘ã§ã‚ã‚Šã€æ–è—¤å…ƒå½¦ã®è²¡æ”¿ã«å¯¾ã™ã‚‹å½±éŸ¿ã¯ç‰¹ã«ãªã„ã€‚"},
    {id:22, q:"é«˜æ ¡ã®ãƒˆã‚¤ãƒ¬ã‚’ç¶ºéº—ã«ã—ãŸã®ã¯ï¼Ÿ", A:"äº•æˆ¸å‰çŸ¥äº‹", B:"æ–è—¤å…ƒå½¦", correct:"A", cpu:"B_wrong", explain:"é«˜æ ¡ãƒˆã‚¤ãƒ¬æ”¹ä¿®ã¯äº•æˆ¸å‰çŸ¥äº‹ã«ã‚ˆã‚‹æ”¿ç­–ã§ã€æ–è—¤å…ƒå½¦å°±ä»»å‰ã«ã»ã¼çµ‚ã‚ã£ã¦ã„ãŸã€‚æ®‹ã•ã‚Œã¦ã„ãŸåˆ†ã‚‚å…ƒå½¦ã¯ãƒãƒ¼ã‚¿ãƒƒãƒã ã£ãŸã¨çœŒæ•™è‚²å§”å“¡ä¼šé–¢ä¿‚è€…ãŒè¨¼è¨€ã€‚"},
    {id:23, q:"ã¯ã°ã‚¿ãƒ³payï¼‹ã®PRç”¨ã†ã¡ã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’æŒã£ã¦ããŸè·å“¡ã«æ–è—¤å…ƒå½¦ãŒãƒ‘ãƒ¯ãƒãƒ©ã‚’ã‹ã¾ã—ãŸç†ç”±ã¯ï¼Ÿ", A:"å†…å®¹ãŒé–“é•ãˆã¦ã„ãŸ", B:"å…ƒå½¦ã®é¡”ãŒå°åˆ·ã•ã‚Œã¦ãªã‹ã£ãŸ", correct:"B", cpu:"B_correct", explain:"ã†ã¡ã‚ã‚’è¦‹ãŸå…ƒå½¦ã¯èˆŒæ‰“ã¡ã‚’ã—ã€å¤§ããªãŸã‚æ¯ã‚’ã¤ã„ã¦ã‹ã‚‰ä½•ãŒæ‚ªã„ã‹åˆ†ã‹ã‚‹ã‹ï¼Ÿã¨è·å“¡ã‚’è©°å•ã—ãŸã€‚æ­£è§£ã¯ã†ã¡ã‚ã«è‡ªåˆ†ã®é¡”ã‚’å…¥ã‚Œã‚ã ã£ãŸã€‚"},
    {id:24, q:"é–‰åº—æ™‚é–“ã‚’éãã¦ã‚‚å–«èŒ¶å®¤ã«å±…åº§ã£ã¦ã„ãŸæ–è—¤å…ƒå½¦ã‚’æ³¨æ„ã—ãŸã‚¹ã‚¿ãƒƒãƒ•ã«å‘ã‘ã¦æ–è—¤å…ƒå½¦ãŒç™ºã—ãŸã‚»ãƒªãƒ•ã¨ã¯ï¼Ÿ", A:"ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚", B:"å…µåº«çœŒçŸ¥äº‹ã§ã™ã€‚", correct:"B", cpu:"B_correct", explain:"ã³ã£ãã‚Šã—ã¦å…µåº«çœŒçŸ¥äº‹ã§ã™ã¨åä¹—ã£ãŸã¨ã„ã†å¸¸äººã«ã¯ç†è§£ã§ããªã„è¨€ã„è¨³ã‚’æ–è—¤å…ƒå½¦ã¯å±•é–‹ã—ãŸã€‚"},
    {id:25, q:"å¤§èµ¤å­—ç¢ºå®šã®æ¥½å¸‚æ¥½åº§ã«æ–è—¤å…ƒå½¦ãŒæµã—ãŸç¨é‡‘ã®é¡ã¯ï¼Ÿ", A:"4å„„å††", B:"å‰æ‘ãŒæ‚ªã„", correct:"A", cpu:"B_wrong", explain:"ã‚¬ãƒ©ã‚¬ãƒ©ã§ã‚ã‚‹ã€‚"},
    {id:26, q:"æ–è—¤å…ƒå½¦ã‚’æ®¿ã¨æ…•ã†å´è¿‘ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã¯ï¼Ÿ", A:"ç²—å“", B:"ç¥–å“", correct:"B", cpu:"A_wrong", explain:"ç¥–å“(ãã—ãƒ¼)ãŒãã„ã¤ã§ã‚ã‚‹ã€‚"},
    {id:27, q:"8æœˆ15æ—¥ã«æˆ¦æ²¡è€…æ…°éœŠå¼ã¸ã®å‡ºå¸­ã‚’éƒ¨ä¸‹ã«æŠ¼ã—ä»˜ã‘ã¦æˆ¦å‹å›½ã®å›½æ——ã‚’ã‚ã—ã‚‰ã£ãŸã‚·ãƒ£ãƒ„ã‚’ç€ã¦ç”²å­åœ’ã§é‡çƒè¦³æˆ¦ã‚’ã—ã¦ç‚ä¸Šã—ãŸæ–è—¤å…ƒå½¦ã€‚å½¼ãŒè‡ªæ’®ã‚Šã—ã¦ãŸæ™‚ã«æ‰‹ã«æŒã£ã¦ã„ãŸã‚‚ã®ã¯ï¼Ÿ", A:"å²©æ´¥ãƒã‚®ã€‚", B:"ã‹ãæ°·ã€‚", correct:"B", cpu:"B_correct", explain:"çµ‚æˆ¦è¨˜å¿µæ—¥ã«æˆ¦æ²¡è€…æ…°éœŠå¼ã‚’ã‚µãƒœã£ãŸæŒ™å¥æ—¥æœ¬ã‚’å€’ã—ãŸå›½ã®å›½æ——ã‚’ã‚ã—ã‚‰ã£ãŸã‚·ãƒ£ãƒ„ã‚’ç€ç”¨ã™ã‚‹ã¨ã„ã†åæ—¥è¡Œç‚ºã§å¤§ç‚ä¸Šã—ãŸã€‚"},
    {id:28, q:"å…µåº«çœŒã®æœé®®å­¦æ ¡ã¸ã®è£œåŠ©é‡‘æ”¯å‡ºé¡ã¯å…¨å›½ä½•ä½ï¼Ÿ", A:"1ä½", B:"2ä½", correct:"A", cpu:"A_correct", explain:"æ–è—¤å…ƒå½¦çœŒæ”¿ã«ãŠã‘ã‚‹æœé®®å­¦æ ¡ã¸ã®è£œåŠ©é‡‘æ”¯å‡ºé¡ã¯å…¨å›½æ–­ãƒˆãƒ„1ä½ã§ã‚ã‚Šã€æ—¥æœ¬å…¨ä½“ã®5å‰²ä»¥ä¸Šã‚’å ã‚ã¦ã„ã‚‹ã€‚"}
  ];

  // ã‚²ãƒ¼ãƒ å®šæ•°
  const QUESTION_COUNT = 10; // æŒ‡ç¤ºé€šã‚Šã€Œ10å•ã€ã§å‹è² 
  const TIME_LIMIT = 10 * 1000; // 10ç§’ï¼ˆmsï¼‰
  const TIMER_UPDATE_MS = 50;

  // UI elements
  const questionText = document.getElementById('questionText');
  const choiceA = document.getElementById('choiceA');
  const choiceB = document.getElementById('choiceB');
  const textA = document.getElementById('textA');
  const textB = document.getElementById('textB');
  const overlayA = document.getElementById('overlayA');
  const overlayB = document.getElementById('overlayB');
  const overlayA_cpu = document.getElementById('overlayA_cpu');
  const overlayB_cpu = document.getElementById('overlayB_cpu');
  const markA = document.getElementById('markA');
  const markB = document.getElementById('markB');
  const timerBar = document.getElementById('timerBar');
  const playerImg = document.getElementById('playerImg');
  const cpuImg = document.getElementById('cpuImg');
  const playerScoreEl = document.getElementById('playerScore');
  const cpuScoreEl = document.getElementById('cpuScore');
  const explainArea = document.getElementById('explainArea');
  const explainText = document.getElementById('explainText');
  const nextBtn = document.getElementById('nextBtn');
  const restartBtn = document.getElementById('restartBtn');
  const bgmToggle = document.getElementById('bgmToggle');
  const centerMessage = document.getElementById('centerMessage');
  const centerMain = document.getElementById('centerMain');
  const centerAction = document.getElementById('centerAction');

  const sfxCorrect = document.getElementById('sfxCorrect');
sfxCorrect.volume = 0.5;  // éŸ³é‡ã‚’åŠåˆ†ã«è¨­å®š
  const sfxWrong = document.getElementById('sfxWrong');
  const bgm = document.getElementById('bgm');
bgm.volume = 0.2; // BGMã®éŸ³é‡ã‚’åŠåˆ†ã«
  // ã‚²ãƒ¼ãƒ  state
  let questions = [];
  let currentIndex = 0;
  let playerScore = 0;
  let cpuScore = 0;
  let timerStart = 0;
  let timerTimer = null;
  let remaining = TIME_LIMIT;
  let answeredPlayer = false;
  let answeredCPU = false;
  let hasAnyCorrect = false;
  let cpuWillBeSilent = false;
  let currentQuestion = null;
  let bgmPlaying = false;

  // --- ãƒ˜ãƒ«ãƒ‘ãƒ¼ ---
  function shuffle(arr){ for(let i=arr.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]} return arr }
  function clamp(n,a,b){return Math.max(a,Math.min(b,n))}

  function pickQuestions(){
    const pool = allQuestions.slice();
    shuffle(pool);
    return pool.slice(0, Math.min(QUESTION_COUNT, pool.length));
  }

  function resetOverlays(){
    overlayA.style.display = 'none';
    overlayB.style.display = 'none';
    overlayA_cpu.style.display = 'none';
    overlayB_cpu.style.display = 'none';
    markA.textContent = '';
    markB.textContent = '';
    choiceA.classList.remove('disabled');
    choiceB.classList.remove('disabled');
  }

  function playBGMIfNeeded(){
    if(!bgmPlaying){
      bgm.play().then(()=>{bgmPlaying=true; bgmToggle.textContent='BGM: åœæ­¢';}).catch(()=>{/* ãƒ¢ãƒã‚¤ãƒ«ã§ç„¡åŠ¹ãªã‚‰ãƒœã‚¿ãƒ³è¡¨ç¤ºã§å¯¾å¿œ */});
    }
  }

  bgmToggle.addEventListener('click', ()=>{
    if(!bgmPlaying){
      bgm.play().then(()=>{bgmPlaying=true; bgmToggle.textContent='BGM: åœæ­¢';}).catch(()=>{ alert('ãƒ–ãƒ©ã‚¦ã‚¶ãŒè‡ªå‹•å†ç”Ÿã‚’è¨±å¯ã—ã¾ã›ã‚“ã§ã—ãŸã€‚ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨å†ç”Ÿã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚');});
    } else {
      bgm.pause(); bgm.currentTime = 0; bgmPlaying = false; bgmToggle.textContent='BGM: å†ç”Ÿ';
    }
  });
// ãƒšãƒ¼ã‚¸ãŒéè¡¨ç¤ºã«ãªã£ãŸã‚‰BGMã‚’åœæ­¢ã€æˆ»ã£ãŸã‚‰å†é–‹
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    // ã‚¿ãƒ–ãŒéè¡¨ç¤ºã«ãªã£ãŸï¼ˆä»–ã®ã‚¢ãƒ—ãƒªãƒ»ã‚¿ãƒ–ã«ç§»å‹•ï¼‰
    if (!bgm.paused) {
      bgm.pause();
      bgmPlaying = false;
      bgmToggle.textContent = 'BGM: å†ç”Ÿ';
    }
  } else {
    // å†ã³è¡¨ç¤ºã•ã‚ŒãŸæ™‚ã«è‡ªå‹•å†ç”Ÿã¯ã—ãªã„ï¼ˆãƒœã‚¿ãƒ³ã§å†é–‹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼‰
  }
});
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å›ç­”å‡¦ç†
  async function playerAnswer(choice){
    if(answeredPlayer) return;
    if(!currentQuestion) return;
    // start BGM on first interaction (mobile autoplay workaround)
    playBGMIfNeeded();

    answeredPlayer = true;
    // show player icon above chosen option
    if(choice === 'A'){ overlayA.style.display='block'; } else { overlayB.style.display='block'; }

    // Determine correctness
    const correct = currentQuestion.correct;
    const isCorrect = (correct === choice) || (correct === 'AB') || (correct === 'both' && (choice==='A'||choice==='B'));
    if(correct === 'none') { // none correct
      // both A and B are wrong
      // so player is incorrect
    }

    if(isCorrect){
      markChoice(choice, true);
      playerScore++;
      playerScoreEl.textContent = playerScore;
      sfxCorrect.currentTime = 0; sfxCorrect.play().catch(()=>{});
      // change images per rules: player correct -> player3.png; CPU image becomes hiko2.png per requirement
      playerImg.src = 'player3.png';
      cpuImg.src = 'hiko2.png';
      hasAnyCorrect = true;
      // show explanation immediately
      clearTimer();
      showExplanation();
    } else {
      markChoice(choice, false);
      sfxWrong.currentTime = 0; sfxWrong.play().catch(()=>{});
      playerImg.src = 'player2.png';
      cpuImg.src = 'hiko3.png';
      // If cpu hasn't answered and is allowed to answer later, continue; otherwise if both answered then end and show explanation
      if(answeredCPU || (!cpuWillAnswerLater())) {
        clearTimer();
        showExplanation();
      }
    }
    // disable player's further clicks
    // (answeredPlayer used)
  }

  function cpuWillAnswerLater(){
    // if cpu is in silent/hiko4/persistent silent mode -> false
    return !cpuWillBeSilent && currentQuestion && currentQuestion.cpu !== 'silent' && currentQuestion.cpu !== 'silent_hiko4';
  }

  function markChoice(choice, ok){
    const markEl = (choice==='A')?markA:markB;
    markEl.textContent = ok ? 'â—¯' : 'Ã—';
  }

  // CPUã®å›ç­”ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  function scheduleCPUAnswer(){
    answeredCPU = false;
    cpuWillBeSilent = false;
    const behavior = currentQuestion.cpu || '';
    if(behavior === 'silent' || behavior === 'silent_hiko4'){
      // change CPU to hiko4 if specified
      if(behavior === 'silent_hiko4') cpuImg.src = 'hiko4.png';
      cpuWillBeSilent = true;
      return;
    }

    // determine cpu's choice depending on behavior tags:
    // possible tags in our data: "A_wrong","B_wrong","A_correct","B_correct"
    // default: answer immediately with a random delay, and choose A/B according to tag
    let choice = 'A';
    if(behavior === 'A_wrong') choice = 'A';
    else if(behavior === 'B_wrong') choice = 'B';
    else if(behavior === 'A_correct') choice = 'A';
    else if(behavior === 'B_correct') choice = 'B';
    else {
      // fallback: choose randomly but not repeat correctness if design
      choice = Math.random() < 0.5 ? 'A' : 'B';
    }

    // simulate CPU answering quickly (few hundred ms) unless player answered first
    const delay = 400 + Math.floor(Math.random()*400); // 400-800ms
    setTimeout(()=>{
      if(answeredCPU) return;
      // If player already answered and it was correct (so question ended), CPU should not answer
      if(hasAnyCorrect) return;
      // CPU answers
      answeredCPU = true;
      // show CPU icon on chosen option
      if(choice === 'A') overlayA_cpu.style.display = 'block'; else overlayB_cpu.style.display = 'block';

      const correct = currentQuestion.correct;
      const isCorrect = (correct === choice) || (correct === 'AB');

      if(isCorrect){
        markChoice(choice, true);
        cpuScore++;
        cpuScoreEl.textContent = cpuScore;
        sfxCorrect.currentTime = 0; sfxCorrect.play().catch(()=>{});
        // CPU correct -> cpu3? Wait mapping: "ã‚¯ã‚¤ã‚ºæ­£è§£æ™‚ã®CPU(hiko3.png)"
        cpuImg.src = 'hiko3.png';
        // Also per user: "CPUãŒã‚¯ã‚¤ã‚ºã«æ­£è§£ã—ãŸæ™‚ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼(player2.png)" -> show player2
        playerImg.src = 'player2.png';
        hasAnyCorrect = true;
        clearTimer();
        showExplanation();
      } else {
        markChoice(choice, false);
        sfxWrong.currentTime = 0; sfxWrong.play().catch(()=>{});
        // CPU wrong -> per mapping CPU wrong image hiko2.png, player becomes player3.png
        cpuImg.src = 'hiko2.png';
        playerImg.src = 'player3.png';
        // if player already answered or player cannot answer anymore, end
        if(answeredPlayer || !playerCanAnswer()) {
          clearTimer();
          showExplanation();
        }
      }
    }, delay);
  }

  function playerCanAnswer(){
    return !answeredPlayer;
  }

  function clearTimer(){
    if(timerTimer) { clearInterval(timerTimer); timerTimer = null; }
  }

  function startTimer(){
    clearTimer();
    timerStart = Date.now();
    remaining = TIME_LIMIT;
    timerBar.style.width = '100%';
    timerTimer = setInterval(()=>{
      const elapsed = Date.now() - timerStart;
      remaining = TIME_LIMIT - elapsed;
      const pct = clamp(remaining / TIME_LIMIT, 0, 1);
      timerBar.style.width = (pct*100) + '%';
      if(remaining <= 0){
        clearTimer();
        // timeout behavior
        handleTimeUp();
      }
    }, TIMER_UPDATE_MS);
  }

  function handleTimeUp(){
    // if no one answered correctly -> play wrong sound
    if(!hasAnyCorrect){
      sfxWrong.currentTime = 0; sfxWrong.play().catch(()=>{});
    }
    // show marks on choices if unanswered? we just show explanation
    showExplanation();
  }

  // show explanation panel
  function showExplanation(){
    explainArea.style.display = 'block';
    explainText.textContent = currentQuestion.explain || 'èª¬æ˜ãªã—';
    // disable choices
    choiceA.classList.add('disabled');
    choiceB.classList.add('disabled');
  }

  // move to next question
  function nextQuestion(){
    explainArea.style.display = 'none';
    resetOverlays();
    currentIndex++;
    if(currentIndex >= questions.length){
      endGame();
    } else {
      loadQuestion(currentIndex);
    }
  }

  function endGame(){
    // show final status
bgm.pause();  // â† ã“ã®1è¡Œã‚’è¿½åŠ 
bgm.currentTime = 0; //ï¼ˆä»»æ„ï¼šåœæ­¢å¾Œã€å†ç”Ÿä½ç½®ã‚’æœ€åˆã«æˆ»ã™ï¼‰
    clearTimer();
    choiceA.classList.add('disabled'); choiceB.classList.add('disabled');
    centerMessage.style.display = 'flex';
    if(playerScore > cpuScore){
      centerMain.textContent = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‹åˆ©ï¼\nãŠã‚ã§ã¨ã†';
      // player->player3, cpu->hiko2
      playerImg.src = 'player3.png';
      cpuImg.src = 'hiko2.png';
    } else if (playerScore < cpuScore){
      centerMain.textContent = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ•—åŒ—';
      playerImg.src = 'player2.png';
      cpuImg.src = 'hiko3.png';
    } else {
      centerMain.textContent = 'å¼•ãåˆ†ã‘';
      // neutral images
      playerImg.src = 'player.png';
      cpuImg.src = 'hiko.png';
    }
  }

  function startGame(){
    // init
    questions = pickQuestions();
    currentIndex = 0;
    playerScore = 0; cpuScore = 0;
    playerScoreEl.textContent = playerScore;
    cpuScoreEl.textContent = cpuScore;
    centerMessage.style.display = 'none';
    resetOverlays();
    loadQuestion(0);
 // ğŸ”¸ BGMã‚’æœ€åˆã‹ã‚‰å†ç”Ÿ
  bgm.currentTime = 0;
  bgm.play();
  bgmPlaying = true;
  bgmToggle.textContent = 'BGM: åœæ­¢'; }

  function loadQuestion(index){
    // reset flags
    answeredPlayer = false; answeredCPU = false; hasAnyCorrect = false; cpuWillBeSilent = false;
    playerImg.src = 'player.png';
    cpuImg.src = 'hiko.png';
    choiceA.classList.remove('disabled'); choiceB.classList.remove('disabled');
    markA.textContent = ''; markB.textContent = '';
    overlayA.style.display = 'none'; overlayB.style.display = 'none'; overlayA_cpu.style.display='none'; overlayB_cpu.style.display='none';
    explainArea.style.display = 'none';
    currentQuestion = questions[index];
    // show q
    questionText.textContent = currentQuestion.q;
    textA.textContent = 'A. ' + currentQuestion.A;
    textB.textContent = 'B. ' + currentQuestion.B;

    // start timer
    startTimer();

    // schedule CPU behavior (immediate answers etc.)
    scheduleCPUAnswer();
  }

  // UI bindings
  choiceA.addEventListener('click', ()=>{ if(!choiceA.classList.contains('disabled')) playerAnswer('A'); });
  choiceB.addEventListener('click', ()=>{ if(!choiceB.classList.contains('disabled')) playerAnswer('B'); });
  // touch-friendly: also respond to touchstart
  choiceA.addEventListener('touchstart', (e)=>{ e.preventDefault(); if(!choiceA.classList.contains('disabled')) playerAnswer('A'); }, {passive:false});
  choiceB.addEventListener('touchstart', (e)=>{ e.preventDefault(); if(!choiceB.classList.contains('disabled')) playerAnswer('B'); }, {passive:false});

  nextBtn.addEventListener('click', ()=>{ nextQuestion(); });
  restartBtn.addEventListener('click', ()=>{ startGame(); });
  centerAction.addEventListener('click', ()=>{ startGame(); });

  // Ensure sounds are unlocked on first user interaction
  document.addEventListener('click', () => {
    playBGMIfNeeded();
  }, { once: true });

// --- ã‚¯ã‚¤ã‚ºã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ ---
const startBtn = document.getElementById('startBtn');

startBtn.addEventListener('click', () => {
  // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã—ã¦
  document.getElementById('startScreen').style.display = 'none';

  // BGMå†ç”Ÿã‚’æœ‰åŠ¹åŒ–ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰
  playBGMIfNeeded();

  // ã‚²ãƒ¼ãƒ é–‹å§‹
  startGame();
});

  // Safety: if bgm didn't start due to autoplay restrictions, user can press bgmToggle
})();
</script>
</body>
</html>
